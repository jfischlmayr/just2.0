@page "/gantt"
@using Syncfusion.Blazor.DropDowns
@using Syncfusion.Blazor.Gantt
@using Syncfusion.Blazor.Buttons
@using JUST.Data;
@using JUST.Data.Models;

@inject IProjectData _db;
@inject ITasksData _db_t;

<SfDropDownList  TValue="string" TItem="Project" Placeholder="Select a project" Width="300px" @bind-Value="projectTitle" DataSource="@projects" Margin="">
	<NoRecordsTemplate>
        <span class='norecord'>No Projects available!</span>
	</NoRecordsTemplate>
</SfDropDownList>

<button class="submit-button" type="submit" style="background-color: white;" >Get Gantt</button>

<SfGantt DataSource="@taskList" Toolbar="@(new List<string>() { "ZoomIn", "ZoomOut", "ZoomToFit" })" Height="850px" Width="1500px">
	<GanttTaskFields Id="ID" Name="Name" StartDate="StartDate" EndDate="EndDate" Duration="Duration" Progress="Progress" Child="SubTasks">
	</GanttTaskFields>
	<GanttColumns>
		<GanttColumn Field="ID" HeaderText="ID" Width="80"></GanttColumn>
		<GanttColumn Field="Name" HeaderText="Name" Width="150"></GanttColumn>
		<GanttColumn Field="StartDate" HeaderText="Start Date" Width="150"></GanttColumn>
		<GanttColumn Field="EndDate" HeaderText="End Date" Width="150"></GanttColumn>
		<GanttColumn Field="Duration" HeaderText="Duration" Width="100"></GanttColumn>
	</GanttColumns>
	<GanttTimelineSettings TimelineUnitSize=120 TimelineViewMode="TimelineViewMode.Month"></GanttTimelineSettings>
	<GanttSplitterSettings Position="42%"> </GanttSplitterSettings>
</SfGantt>


@code{
	public List<JustTask> allTasks = new List<JustTask>();
	public List<JustTask> taskList = new List<JustTask>();
	public List<Project> projects = new List<Project>();
	public string projectTitle = "";

	protected override async Task OnInitializedAsync()
	{
		allTasks = await _db_t.GetTasks();
		projects = await _db.GetProjects();
	}

	public void getGantt()
	{
		var projectID = projects.Find(p => p.Title == projectTitle).ID;
		taskList = allTasks.Where(t => t.ProjectID == projectID).ToList();

	}
}